<include file="Public:header" />
<script>
    $(function () {
        $(".add_body").height(window.innerHeight - $("#add_body").offset().top - $("#tfoot_div").height() - 20);
        $(window).resize(function () {
            $(".add_body").height(window.innerHeight - $("#add_body").offset().top - $("#tfoot_div").height() - 20);
        })
    })
</script>
<div class="wrapper wrapper-content">
    <include file="Public:alert" />
    <div class="row">
        <div class="col-lg-12">
            <include file="Setting:setting_left" />
            <div class="col-sm-10 ">
                <div class="table-content" style="padding-bottom:10px">
                    <div class="ibox-content mar-top " style="border-bottom:none;padding-top:20px;">
                        <div class="bulk-actions align-left">
                            <div class="btn btn-primary" style="background:#fff;border-width:0px;color:#000;">
                                自定义审批流
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-12 ibox-content">
                        <div class="add_body" id="add_body">
                            <div class="full-height-scroll">
                                <volist name="list" id="vo">
                                    <div style="border-bottom:1px solid #ccc;">
                                        <!-- <div class="pull-left" style="background:transparent url('__PUBLIC__/img/003.png') no-repeat scroll 0px {$vo['img_repeat']};width:50px;height:50px;margin:10px;"></div> -->
                                        <div class="pull-left bg-danger fa-exam" style="width: 50px; height: 50px; margin: 10px; border-radius: 5px;">
                                            <i class="fa fa-clipboard" style="line-height: 50px; font-size: 25px; margin-left: 12.5px;"></i>
                                        </div>
                                        <div class="pull-left col-lg-2" style="margin-top:8px;min-width: 200px;">
                                            <div style="font-size:14px;">{$vo['name']}</div>
                                            <div style="font-size:13px;color:#999">{$vo['remark']}</div>
                                            <div style="font-size:11px;color:#999">{$vo['update_time']|date="Y.m.d H:i",###} 更新</div>
                                        </div>
                                        <div class="pull-right col-lg-3" style="margin-top:10px;padding:15px">
                                            <div class="radio radio-info radio-inline" title="启用后,申请流程将会固定，用户无需选择下一审批人">
                                                <input type="radio" class="type_status" name="status_{$key}" id="status_{$key}_1" rel="{$vo['type_id']}" value="1" <?php echo $vo['status'] == 1 ? 'checked' : '';  ?>>
                                                <label for="status_{$key}_1">启用&nbsp;&nbsp;</label>
                                            </div>
                                            <div class="radio radio-info radio-inline" style="margin-left: 0px;padding-left: 10px;" title="禁用后,用户自选下一审批人。">
                                                <input type="radio" class="type_status" name="status_{$key}" id="status_{$key}_0" rel="{$vo['type_id']}" value="0" <?php echo $vo['status'] == 0 ? 'checked' : '';  ?>>&nbsp;
                                                <label for="status_{$key}_0">禁用</label>
                                            </div>&nbsp;
                                            <a href="{:U('exam/view', array('id' => $vo['type_id']))}" class="option" <?php echo $vo['status'] == '1' ? '' : 'hidden'; ?> >设置</a>
                                        </div>
                                        <div style="clear:both"></div>
                                    </div>
                                </volist>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="dialog-message2" class="" style="display:none;" title="修改自定义审批">
    <div class="spiner-example">
        <div class="sk-spinner sk-spinner-three-bounce">
            <div class="sk-bounce1"></div>
            <div class="sk-bounce2"></div>
            <div class="sk-bounce3"></div>
        </div>
    </div>
</div>
<script type="text/javascript">
$(function () {
    $('.type_status').on('change', function () {
        var self = $(this);
        var type_id = $(this).attr('rel');
        var status = $(this).val();
        ajax_loading();
        $.ajax({
            url: '{:U("exam/status_edit")}',
            data: {type_id: type_id, status: status},
            type: 'POST',
            dataType: 'JSON',
            success: function (res) {
                if (res.status == 1) {
                    var type = 'success';
                    if (status == 0) {
                        self.parents('.pull-right').find('.option').hide();
                    } else {
                        self.parents('.pull-right').find('.option').show();
                    }
                } else {
                    if (res.status == 0) {
                        var type = 'error';
                    } else if (res.status == 2) {
                        var type = 'warning';
                    }
                    temp_val = status == 1 ? 0 : 1;
                    $('[rel="' + type_id + '"][value="' + status + '"]').prop('checked', false);
                    $('[rel="' + type_id + '"][value="' + temp_val + '"]').prop('checked', true);
                }
                swal(res.msg, '', type);
            }
        });
    });
});
</script>
<include file="Public:footer" />