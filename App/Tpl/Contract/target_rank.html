<include file="Public:header" />
<script type="text/javascript" src="__PUBLIC__/style/js/TableFreeze.js"></script>
<script src="__PUBLIC__/style/js/plugins/nice-scroll/jquery.nicescroll.min.js" type="text/javascript"></script>

<!--jQuery导出插件-->
<script type="text/javascript" src="__PUBLIC__/js/table-export/jquery.base64.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/table-export/tableExport.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/table-export/jspdf/libs/sprintf.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/table-export/jspdf/jspdf.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/table-export/jspdf/libs/base64.js"></script>
<!--jQuery导出插件-->
<style>
	body{
		overflow-y: hidden;
	}
	.fa-info-circle {
		font-size: 16px;
		color: rgb(249, 94, 0);
		cursor: pointer;
	}
	.popover {
	 	color: rgb(249, 94, 0);
	}
</style>
<script>
	$(function(){
		$("#table_div").height(window.innerHeight - $("#table_div").offset().top - 30);
		$(window).resize(function(){
			$("#table_div").height(window.innerHeight-$("#table_div").offset().top-$("#tfoot_div").height()-30);
			$("#oDivL_tab_Test3").height($("#table_div").height()).width($("#oTableLH_tab_Test3").width());
			$("#oDivH_tab_Test3").height($("#oTableLH_tab_Test3").height()).width($("#table_div").width());
			$('#oDivH_tab_Test3 table').width($("#table_div").width());
		});
		var scroll_width = 10;
		$(".nicescroll").niceScroll({
			cursorcolor: "#999",//#CC0071 光标颜色 
		    cursoropacitymax: 0.4, //改变不透明度非常光标处于活动状态（scrollabar“可见”状态），范围从1到0 
		    touchbehavior: false, //使光标拖动滚动像在台式电脑触摸设备 
		    cursorwidth: scroll_width+"px", //像素光标的宽度 
		    cursorborder: "0", //     游标边框css定义 
		    cursorborderradius: "3px",//以像素为光标边界半径 
		    autohidemode: false, //是否隐藏滚动条 
		    zindex:100,
		    background:"#F3F3F5",//滚动条背景色
		});
		//table固定，对应 上、下、左
		$("#tab_Test3").FrozenTable(1,0,0);
		$("#oDivL_tab_Test3").height($("#table_div").height()).width($("#oTableLH_tab_Test3").width());
		$("#oDivH_tab_Test3").height($("#oTableLH_tab_Test3").height()).width($("#table_div").width() -3);
	});
</script>
<div class="wrapper wrapper-content">
	<div class="row">
		<div class="col-lg-12">
			<div class="ibox float-e-margins">
				<include file="Public:analytics_left" />
				<div class="col-lg-10">
					<div class="ibox-content" style="padding-bottom:0px;border-bottom: none;">
						<include file="Public:alert" />
						<form id="search_form" class="form-group" method="get" style="margin-bottom: 0px;">
							<input type="hidden" name="m" value="contract" />
							<input type="hidden" name="a" value="target_rank" />
							<div class="row" style="height: 45px;">
								<div class="col-lg-4">
									<div class="pull-left" >
										<span style="font-size: 18px;color: #000;">员工业绩目标完成率排行</span>
										<i class="fa fa-info-circle" data-trigger="hover" data-container="body" data-toggle="popover" data-placement="top" data-content="注：销售额按签约时间在搜索范围内的合同金额统计，回款额按收款时间在搜索范围内的回款单金额统计。" data-original-title="" title=""></i>
									</div>
								</div>
								<div class="col-lg-5"></div>
								<div class="col-lg-3">
									<div class="pull-right">
										<span class="fa fa-download" style="color:#75899D;"></span>
										<a style="color: #75899D;" onClick ="$('#tab_Test3').tableExport({type: 'excel', escape: 'false', self: $(this)});">导出</a>
									</div>
								</div>
							</div>
							<div class="row">
								<div class="col-lg-12" >
									<div class="nav pull-left">
										<div class="input-group" style="margin:2px 0 0 0px;">
											<select class="form-control input-sm" name="target_type" >
												<option value="1" <if condition="$_GET['target_type'] eq 1">selected</if> >销售额</option>
												<option value="2" <if condition="$_GET['target_type'] eq 2">selected</if> >回款金额</option>
											</select>
										</div>
									</div>
									<div class="nav pull-left" style="margin:2px 0 0 15px;width: 165px;">
										<div class="input-group">
											<select class="form-control select2" style="min-width:165px;max-width: 165px;height: 0px;" name="department">
												<option class="all" value="all"> -- 全公司 -- </option>
												<volist name="departmentList" id="vo">
													<option value="{$vo.department_id}" <if condition="$_GET['department'] eq $vo['department_id']">selected</if>>{$vo.name}</option>
												</volist>
											</select>
										</div>
									</div>
									<div class="nav pull-left" style="margin:2px 0 0 15px;width: 165px;">
										<div class="input-group">
											<input type="text" name="start_date" id="start_date" onFocus="WdatePicker({dateFmt:'yyyy-MM'})" value="{$_GET['start_date']}" autocomplete="off" class="form-control Wdate" placeholder="起始年月" required />
										</div>
									</div>
									<div class="nav pull-left" style="margin:2px 0 0 15px;width: 165px;">
										<div class="input-group">
											<input type="text" name="end_date" onFocus="WdatePicker({dateFmt:'yyyy-MM', minDate: $('#start_date').val(), maxDate: $('#start_date').val().substr(0, 4) + '-12'})" value="{$_GET['end_date']}" autocomplete="off" class="form-control Wdate"  placeholder="截至年月" required />
										</div>
									</div>
									<div class="pull-left" style="margin-left: 20px;">
										<button type="submit" id="analytics_search" class="btn btn-primary">{:L('SEARCH')}</button>
									</div>
								</div>
							</div>
						</form>
					</div>
					<div class="ibox-content clearfix" id="right_height" style="border-top: none;">
						<div id="report_content" class="th_content" style="position:relative;">
							<div id="table_div" class="nicescroll" style="left:0px;top:0px;">
								<table class="table table-hover table-striped table_thead_fixed table-bordered" id="tab_Test3">
									<tr>
										<td>员工姓名</td>
										<td>所属部门</td>
										<td>目标金额</td>
										<td>完成额</td>
										<td>完成率</td>
										<td>排名</td>
									</tr>
									<empty name="list">
										<tr>
											<td colspan="6"><include file="Public:nodata" /></td>
										</tr>
									<else />
										<volist name="list" id="vo">
											<tr>
												<td>
													<a href="javascript:void(0)" class="role_info" rel="{$vo['owner_role_id']}">{$vo['user_name']}</a>
												</td>
												<td>{$vo['department_name']}</td>
												<td>{:number_format($vo['target_price'], 2)}</td>
												<td>{:number_format($vo['sum_price'], 2)}</td>
												<td>{$vo['finish_rate']}%</td>
												<td>{$key+1}</td>
											</tr>
										</volist>
									</empty>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<div style="display:none;" id="dialog-role-info" title="{:L('DIALOG_USER_INFO')}">
	<div class="spiner-example">
		<div class="sk-spinner sk-spinner-three-bounce">
			<div class="sk-bounce1"></div>
			<div class="sk-bounce2"></div>
			<div class="sk-bounce3"></div>
		</div>
	</div>
</div>
<script type="text/javascript">
	//查看员工信息
	$("#dialog-role-info").dialog({
	    autoOpen: false,
	    modal: true,
		width: 650,
		maxHeight:600,
		position: ["center",100]
	});
	$(".role_info").click(function(){
		$role_id = $(this).attr('rel');
		$('#dialog-role-info').dialog('open');
		$('#dialog-role-info').load('{:U("user/dialoginfo","id=")}'+$role_id);
	});
</script>
<include file="Public:footer" />