<style>
	body{
		overflow-y: hidden;
	}
	table tbody tr{cursor:move;}
	.active {color: #000;}
	.nav.nav-tabs-left li{width:100%;}
	.nav-tabs-left>li.active>a{border-top:white;color: #19aa8d !important;background-color:#fff;}
	
	/*主要样式*/
	.subNavBox{width:100%;margin-top:0px;margin-bottom:50px;}
	.subNav{
		cursor:pointer;
		font-size:14px;
		color:#000;
		line-height:40px;
		padding-left:10px;
	}
	.subNav_text{
		cursor:pointer;
		font-size:14px;
		color:#000;
		line-height:40px;
		padding-left:10px;
	}
	subNavBox ul{margin-bottom:18px;}
	.subNav:hover{color:#375264;}
	/*.currentDt{background-image:url(__PUBLIC__/img/jiantou.jpg);}*/
	.navContent{list-style: none;display: none;padding-left: 13px;}
	.navContent li a{display:block;width:100%;height:32px;text-align:left;font-size:13px;line-height:32px;color:#000;}
	.li_text{padding-left:10px;width: 100%;float:left;line-height:32px;margin-bottom:3px;}
	.li_text:hover{background-color:#f5f5f5;}
	.li_text_active{float:left;background-color:#f5f5f5;padding-left:10px;width: 100%;border-left:2px solid #03a9f4;line-height:32px;margin-bottom:3px;color:#03a9f4;}
	ol, ul {
	    margin-top: 0;
	    margin-bottom: 0px;
	}
</style>
<div class="col-sm-2 ibox-title" style="background-color:#fff;padding-bottom:5px;" id="left_height">
	<div class="full-height-scroll">
		<?php
			$module_name = strtolower(MODULE_NAME);
			$action_name = strtolower(ACTION_NAME);
		?>
		<div class="subNavBox">
			<if condition = "session('?admin')">
				<div class="subNav currentDd currentDt">用户和权限</div>
				<ul class="navContent" style="display:block">
					<li >
						<a href="{:U('user/department')}" ><span <if condition = "$module_name == 'user' && $action_name == 'department'">class="li_text_active"<else />class="li_text"</if>>组织架构管理</span></a>
					</li>
					</if>
					<if condition = "checkPerByAction('user','index')">
					<li >
						<a href="{:U('user/index')}" ><span <if condition = "$module_name == 'user' && $action_name == 'index'">class="li_text_active"<else />class="li_text"</if>>用户管理</span></a>
					</li>
				</ul>
			</if>
			<if condition = "session('?admin')">
				<div class="subNav currentDd currentDt">手机banner图</div>
				<ul class="navContent" style="display:block">
					<li >
						<a href="{:U('setting/banner')}" ><span <if condition = "$module_name == 'setting' && $action_name == 'banner'">class="li_text_active"<else />class="li_text"</if>>banner</span></a>
					</li>
					</if>
				</ul>
			</if>

			<if condition = "session('?admin')">
				<div class="subNav currentDd currentDt">自定义字段设置</div>
				<ul class="navContent" style="display:block">
					<li ><a href="{:U('setting/fields', 'model=leads')}" ><span <if condition="$_GET['model'] eq 'leads'">class="li_text_active"<else />class="li_text"</if>>线索</span></a></li>
					<li ><a href="{:U('setting/fields', 'model=customer')}" ><span <if condition="$_GET['model'] eq 'customer'">class="li_text_active"<else />class="li_text"</if>>客户</span></a></li>
					<li ><a href="{:U('setting/fields', 'model=contacts')}" >
					<span <if condition="$_GET['model'] eq 'contacts'">class="li_text_active"<else />class="li_text"</if>>联系人</span></a></li>
					<li ><a href="{:U('setting/fields', 'model=business')}" >
					<span <if condition="$_GET['model'] eq 'business'">class="li_text_active"<else />class="li_text"</if>>商机</span></a></li>
					<li ><a href="{:U('setting/fields', 'model=product')}" ><span <if condition="$_GET['model'] eq 'product'">class="li_text_active"<else />class="li_text"</if>>产品</span></a></li>
					<li ><a href="{:U('setting/fields', 'model=contract')}" ><span <if condition="$_GET['model'] eq 'contract'">class="li_text_active"<else />class="li_text"</if>>合同</span></a></li>
					<li ><a href="{:U('setting/fields', 'model=market')}" ><span <if condition="$_GET['model'] eq 'market'">class="li_text_active"<else />class="li_text"</if>>市场活动</span></a></li>
					<li ><a href="{:U('setting/fields', 'model=supplier')}" ><span <if condition="$_GET['model'] eq 'supplier'">class="li_text_active"<else />class="li_text"</if>>供应商</span></a></li>
				</ul>
			</if>
			<div class="subNav currentDd currentDt">业务参数设置</div>
			<ul class="navContent" style="display:block">
				<if condition = "session('?admin')">
					<li ><a href="{:U('setting/setup')}" ><span <if condition="$module_name eq 'setting' && $action_name == 'setup'">class="li_text_active"<else />class="li_text"</if> >基本参数</span></a></li>
					<li ><a href="{:U('product/category')}" ><span <if condition="$module_name eq 'product' && $action_name == 'category'">class="li_text_active"<else />class="li_text"</if>>产品分类</span></a></li>
					<li ><a href="{:U('knowledge/category')}" ><span <if condition="$module_name eq 'knowledge' && $action_name == 'category'">class="li_text_active"<else />class="li_text"</if>>{:L('KNOWLEDGE_CATEGORY')}</span></a></li>
					<li ><a href="{:U('setting/businesstype')}" ><span <if condition="$module_name eq 'setting' && ($action_name == 'businessstatus' || $action_name == 'businesstype')">class="li_text_active"<else />class="li_text"</if>>商机状态组</span></a></li>
					<li ><a href="{:U('setting/category')}" ><span <if condition="$module_name eq 'setting' && $action_name == 'category'">class="li_text_active"<else />class="li_text"</if>>银行账户</span></a></li>
					<li ><a href="{:U('setting/logstatus')}" ><span <if condition="$module_name eq 'setting' && ($action_name == 'logstatus' || $action_name == 'logreply')">class="li_text_active"<else />class="li_text"</if>>沟通类型</span></a></li>
					<li ><a href="{:U('setting/finance','field=payables')}" ><span <if condition="$module_name eq 'setting' && ($action_name == 'finance')">class="li_text_active"<else />class="li_text"</if>>应付款类型</span></a></li>
				</if>
				<if condition = "checkPerByAction('template','index')">
					<li ><a href="{:U('template/index')}" ><span <if condition="$module_name eq 'template' && ($action_name == 'index')">class="li_text_active"<else />class="li_text"</if>>模板设置</span></a></li>
				</if>
			</ul>
			<div class="subNav currentDd currentDt">审批设置</div>
			<if condition = "session('?admin')">
				<ul class="navContent" style="display:block">
					<li>
						<a href="{:U('contract/examine')}">
							<span <if condition="$module_name eq 'contract' && $action_name == 'examine'">class="li_text_active"
								<else />class="li_text"</if> >合同审批流</span>
						</a>
					</li>
					<li>
						<a href="{:U('exam/index')}">
							<span <if condition="$module_name eq 'exam'">class="li_text_active"
								<else />class="li_text"</if> >自定义审批流</span>
						</a>
					</li>
					<li>
						<a href="{:U('setting/examine')}">
							<span <if condition="$module_name eq 'setting' && ($action_name == 'examine' || $action_name == 'examinetype' || ($action_name == 'fields' && $_GET['model'] == 'examine'))">class="li_text_active"
								<else />class="li_text"</if> >办公审批</span>
						</a>
					</li>
				</ul>
			</if>
			<if condition = "session('?admin') || checkPerByAction('kaoqin','setting')">
				<div class="subNav currentDd currentDt">考勤规则设置</div>
				<ul class="navContent" style="display:block">
					<!-- 判断今年工作日是否配置 -->
					<?php 
						$is_set = M('Workrule')->where(array('year'=>date('Y')))->find();
					?>
					<li ><a href="{:U('setting/workrule')}" ><span <if condition="$module_name eq 'setting' && $action_name == 'workrule'">class="li_text_active"<else />class="li_text"</if>>工作日配置&nbsp;&nbsp;<if condition = "$is_set eq ''"><i title="请配置今年的工作日" class="fa fa-warning" style="color: #ffb173;"></i></if></span></a></li>
					<li ><a href="{:U('kaoqin/setting')}" ><span <if condition="$module_name eq 'kaoqin' && $action_name == 'setting'">class="li_text_active"<else />class="li_text"</if>>考勤规则</a></li>
				</ul>
			</if>
				<!-- <div class="subNav" class="subNav currentDd currentDt">财务参数设置</div>
				<ul class="navContent" style="display:block">
					<li ><a href="{:U('account_setting/account')}" ><span <if condition="$module_name eq 'accountsetting' && $action_name == 'account'">class="li_text_active"<else />class="li_text"</if> >科目管理</span></a></li>
					<li ><a href="{:U('account_setting/activity')}" ><span <if condition="$module_name eq 'accountsetting' && $action_name == 'activity'">class="li_text_active"<else />class="li_text"</if>>财务类别</span></a></li>
					<li ><a href="{:U('account_setting/parameter')}" ><span <if condition="$module_name eq 'accountsetting' && $action_name == 'parameter'">class="li_text_active"<else />class="li_text"</if>>凭证字</span></a></li>
					<li ><a href="{:U('account_setting/auxiliary')}" ><span <if condition="$module_name eq 'accountsetting' && $action_name == 'auxiliary'">class="li_text_active"<else />class="li_text"</if>>辅助核算</span></a></li>
					<li ><a href="{:U('account_setting/balance')}" ><span <if condition="$module_name eq 'accountsetting' && $action_name == 'balance'">class="li_text_active"<else />class="li_text"</if>>财务初始余额</span></a></li>
				</ul> -->
			<if condition = "session('?admin')">
				<div class="subNav currentDd currentDt">系统设置</div>
				<ul class="navContent" style="display:block">
					<!-- <li ><a href="{:U('setting/defaultinfo')}" ><span <if condition="$module_name eq 'setting' && $action_name == 'defaultinfo'">class="li_text_active"<else />class="li_text"</if> >基本设置</span></a></li> -->
					<li ><a href="{:U('setting/smtp')}" ><span <if condition="$module_name eq 'setting' && $action_name == 'smtp'">class="li_text_active"<else />class="li_text"</if>>SMTP设置</span></a></li>
					<li ><a href="{:U('setting/sms')}" ><span <if condition="$module_name eq 'setting' && $action_name == 'sms'">class="li_text_active"<else />class="li_text"</if> >短信设置</span></a></li>
				</ul>
			</if>
<!-- 			<if condition = "session('?admin')">
				<div class="subNav currentDd currentDt">呼叫中心</div>
				<ul class="navContent" style="display:block">
					<li ><a href="{:U('call/setting')}" ><span <if condition="$module_name eq 'call' && $action_name == 'setting'">class="li_text_active"<else />class="li_text"</if> >基本设置</span></a></li>
				</ul>
			</if> -->
			<if condition = "session('?admin')">
				<div class="subNav currentDd currentDt">进销存</div>
				<ul class="navContent" style="display:block">
					<li ><a href="{:U('system/pssSetup')}" ><span <if condition="$module_name eq 'system' && $action_name == 'psssetup'">class="li_text_active"<else />class="li_text"</if> >基本设置</span></a></li>
				</ul>
			</if>
		</div>
	</div>
</div>
<script type="text/javascript">
	$(function(){
		// 设置左侧菜单栏高度
		$("#left_height").height($(window).height() - $("#left_height").offset().top - 32);
		// 浏览器缩放时，重新设置左侧菜单栏高度
		$(window).resize(function(){
			$("#left_height").height($(window).height() - $("#left_height").offset().top - 32);
		});

		// 优化左侧菜单栏，根据选中的菜单自动调整位置
		var fixed_height = $('#left_height').height() - 50; // 获取滚动条父级的固定窗口高度，减50是为了凑值，保证选中菜单在较低的位置就触发滚动条自动滚动功能
		var scroll_height = $('.li_text_active').offset().top - $('.subNavBox').offset().top; // 选中的菜单距离"父div"顶部的高度，即已滚动的高度				
		if (scroll_height > fixed_height) {
			$('#left_height .full-height-scroll').animate({scrollTop: scroll_height}, 1000); // 1秒滑动到指定位置
		}
	});
</script>