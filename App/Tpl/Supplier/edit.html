<include file="Public:header" />
<script type="text/javascript" src="__PUBLIC__/js/PCASClass.js" ></script>
<style type="text/css">
.add_title{
	padding-bottom:10px;
	height: 60px;
	margin-bottom:15px;
}
.add_title>span{
	border-bottom: 2px solid #1ab394;
	font-size: 24px;
}
.add_body >div >.full-height-scroll{
	border-right:1px dotted #ccc
}
.add_body_title{
	margin:20px auto 20px auto;
	padding-left: 25px;
}
.add_body_form{
	padding-left: 38px;
}
.add_body_form>form>.form-group{
	margin-bottom: 25px;
}
body{overflow-y:hidden;}
.form-control{
	float:left;
}
.checkbox{float:left;}
</style>
<script>
$(function(){
	$(".add_body").height(window.innerHeight-$("#add_body").offset().top-$("#tfoot_div").height()-40);
	$(window).resize(function(){
		$(".add_body").height(window.innerHeight-$("#add_body").offset().top-$("#tfoot_div").height()-40);
	})
})
</script>
<div class="wrapper wrapper-content animated fadeIn col-md-6">
	<include file="Public:alert" />
	<form class="form-horizontal" id="form_supplier" role="form" action="{:U('supplier/edit')}" method="post">
	<input type="hidden" name="supplier_id" id="supplier_id" value="{$supplier.supplier_id}"/>
	<input type="hidden" name="jump_url" value="{$jump_url}"/>
	<input type="hidden" name="p" value="{$p}">
	<div class="ibox-content add_body" id="add_body" >
		<div class="row">
			<div class="col-md-12 add_body">
				<div class="full-height-scroll">
					<div class="row" >
						<div class="col-md-12 add_body_title">
							<div class="all-inline">
								<span class="sq-tag"></span>
								<div class="text-tag">
									<span>基础信息</span>
								</div>
							</div>
						</div>
						<div class="col-md-11 add_body_form">
							<volist name="field_list['main']" id="vo" key="key">
								<div class="form-group">
									<label class="col-md-4 control-label">{$vo.name}：</label>
									<if condition="$vo['form_type'] == 'textarea'">
										<if condition = "$vo['tip_start'] eq 1">
											<div class="col-md-6">
												{$vo.html}
											</div>
											<div class="col-md-2"><span style="color: red;line-height: 32px;margin-left: 10px;">*</span></div>
										<else/>
											<div class="col-md-8">
												{$vo.html}
											</div>
										</if>
									<elseif condition="$vo['form_type'] == 'address'"/>
										<if condition = "$vo['tip_start'] eq 1">
											<div class="col-md-7">
												{$vo.html}
											</div>
											<div class="col-md-1"><span style="color: red;line-height: 32px;margin-left: 10px;">*</span></div>
										<else/>
											<div class="col-md-8">
												{$vo.html}
											</div>
										</if>
									<elseif condition="$vo['form_type'] == 'box'"/>
										<div class="col-md-6">
											{$vo.html}
										</div>
										<if condition = "$vo['tip_start'] eq 1">
											<div class="col-md-2"><span style="color: red;line-height: 32px;margin-left: 10px;">*</span></div>
										<else/>
											<div class="col-md-2"></div>
										</if>
									<else/>
										<div class="col-md-6">
											{$vo.html}
										</div>
										<if condition = "$vo['tip_start'] eq 1">
											<div class="col-md-2"><span style="color: red;line-height: 32px;margin-left: 10px;">*</span></div>
										<else/>
											<div class="col-md-2"></div>
										</if>
									</if>
								</div>
							</volist>
						</div>
						<div class="col-md-12 add_body_title">
							<div class="all-inline">
								<span class="sq-tag"></span>
								<div class="text-tag">
									<span>附加信息</span>
								</div>
							</div>
						</div>
						<div class="col-md-11 add_body_form">
							<volist name="field_list['data']" id="vo" key="key">
								<div class="form-group">
									<label class="col-md-4 control-label">{$vo.name}：</label>
									<if condition="$vo['form_type'] == 'address' || $vo['form_type'] == 'box'">
										<div class="col-md-7">
											{$vo.html}
										</div>
										<if condition = "$vo['tip_start'] eq 1">
											<div class="col-md-1"><span style="color: red;line-height: 32px;margin-left: 10px;">*</span></div>
										<else/>
											<div class="col-md-1"></div>
										</if>
									<else/>
										<div class="col-md-6">
											{$vo.html}
										</div>
										<if condition = "$vo['tip_start'] eq 1">
											<div class="col-md-2"><span style="color: red;line-height: 32px;margin-left: 10px;">*</span></div>
										<else/>
											<div class="col-md-2"></div>
										</if>
									</if>
								</div>
							</volist>
						</div>
						<div class="col-md-1 pull-right">
							<!-- <div style="height: 100%; border-right: 1px dashed gray;">&nbsp;sadf</div> -->
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div id="tfoot_div" class="clearfix" style="text-align:center">
		<div class="clearfix" id="tfoot_page">
			<div class="ibox-content" style="border-top: none;">
				<div class="col-sm-offset-2" style="margin-left:0px;"><button type="submit" class="btn btn-primary">保存</button></div>
			</div>
		</div>
	</div>
	</form>
</div>
<div id="dialog-role-list" class="" style="display:none" title="{:L('CHOOSE_THE_LEADS_OWNER')}">loading...</div>
<div class="" style="display:none" id="dialog-transform" title="{:L('CONVERT_LEADS')}">
	<form id="transform" action="{:U('supplier/transform')}" method="Post">
		<input type="hidden" name="supplier_id" value="{$supplier.supplier_id}"/>
		<p>{:L('CONVERT_TO_CUSTOMER_CONTACTS')}</br>
		&nbsp; &nbsp; {:L('CUSTOMER_NAME')}&nbsp; {$supplier.company}</br>
		&nbsp; &nbsp; {:L('CONTACTS_NAME')}&nbsp; {$supplier.name}</br>
		<span style="color:red">{:L('NEED_COMPANY_CONTACTS')}</span></p>
		<h6>{:L('CREATE_BUSINESS_FOR_CUSTOMER')}</h6>
		</p>
		<div class="" id="addbusiness">
			<table class="table">
				<tr><td class="tdleft">{:L('BUSINESS_NAME')}</td><td><input  type="text" name="business_name" id="name"></td></tr>
				<tr><td class="tdleft">{:L('EXPECTED_DEAL_DATE')}</td><td><input  type="text"  onclick="WdatePicker()" name="due_date"/></td></tr>
				<tr><td class="tdleft">{:L('BUSINESS_LEVEL')}</td>
					<td>
						<select name="status_id">
							<volist name="businessStatusList" id="vo"><option value="{$vo.status_id}">{$vo.name}</option></volist>
						</select>
					</td>
				</tr>
				<tr><td class="tdleft">{:L('PRICE')}</td><td><input type="text" id="total" name="total"/></td></tr>
			</table>
		</div>
		{:L('ASSIGN_TO_SOMEONE_AFTER_CONVERTED')}<input type="hidden" id="tranform_owner_id" name="owner_role_id" value="{$supplier.owner_role_id}"/><input type="text" id="tranform_owner_name" name="owner_name"/>
	</form>
</div>
<div class="" style="display:none" id="transform-role-list" title="{:L('CHOOSE_THE_LEADS_OWNER')}">loading...</div>
<div class="" style="display:none" id="dialog-validate" title="{:L('VALIDATE_COMPANY_RESULT')}">
	<div id="search_supplier_content"></div>
	<div id="search_customer_content"></div>
</div>
<script type="text/javascript">
$(document).ready(function(){
	/*form表单验证*/
	$("#form_supplier").validate({
	
	});
});
$("[data-type='nummber']").keyup(function(){
	if(isNaN($(this).val())){
		$(this).val($(this).val().replace(/\D/g,''))
	}
});
<if condition="C('ismobile') eq 1">width=$('.container').width() * 0.9;<else/>width=800;</if>
$("#dialog-role-list").dialog({
	autoOpen: false,
	modal: true,
	width: width,
	maxHeight: 400,
	buttons: {
		"确定": function () {
			var item = $('input:radio[name="owner"]:checked').val();
			var name = $('input:radio[name="owner"]:checked').parent().next().html();
			if(item) {
				$('#owner_name').val(name);
				$('#owner_id').val(item);
			}
			$(this).dialog("close"); 
		},
		"取消": function () {
			$(this).dialog("close");
		}
	},
	position: ["center", 100]
});
$("#dialog-validate").dialog({
	autoOpen: false,
	modal: true,
	width: 400,
	maxHeight: 400,
	buttons: { 
		"确定": function () {
			$(this).dialog("close"); 
		}
	},
	position: ["center", 100]
});
$(function(){
	$('#owner_name').click(
		function(){
			$('#dialog-role-list').dialog('open');
			$('#dialog-role-list').load("{:U('user/listDialog')}");
		}
	);
	$('#validate').click(
		function(){
			name = $('#company').val();
			if(name!=''){
				$.post('{:U("supplier/validate")}',
					{ 
						name:name,
					},
					function(data){
						alert(data.info);
					},
				'json');
			} else {
				alert("{:L('NEED_COMPANY_NAME')}");
			}
		}
	);
	$('#remove').click(
		function(){
			alert("{:L('PUT_LEADS_INTO_THE_POOL_AND_PLEASE_CLICK_SAVE')}");
			$('#owner_id').attr('value', '');
			$('#owner_name').attr('value', "{:L('PUT_LEADS_INTO_THE_POOL')}");
		}
	);
});
</script>
<include file="Public:footer" />